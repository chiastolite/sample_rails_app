box: wercker/rvm
services:
  - wercker/postgresql
build:
  steps:
    - rvm-use:
        version: ruby-2.1.2
    - rails-database-yml:
        service: postgresql
    - bundle-install
    - script:
        name: Set up db
        code: bundle exec rake db:create db:migrate RAILS_ENV=test
    - script:
        name: rake
        code: bundle exec rake
deploy:
  steps:
    - heroku-deploy
    - script:
        name: update database
        code: heroku run rake db:migrate --app $APP_NAME
  after-steps:
    - 1syo/idobata-notify@0.1.2:
        token: $IDOBATA_TOKEN
